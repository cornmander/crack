# Test cairo 2D drawing library binding
# Conrad Steenberg <conrad.steenberg@gmail.com>
#
# This tests the translation of the C library
# Follow example code at http://cairographics.org/tutorial/

import crack.lang CString;
import crack.io cout;
import crack.ext._cairo    cairo_surface_t, cairo_t, cairo_image_surface_create,
                           CAIRO_FORMAT_ARGB32, cairo_create, cairo_move_to,
                           cairo_line_to, cairo_rel_line_to,
                           cairo_arc, cairo_rel_curve_to,
                           cairo_close_path, cairo_surface_write_to_png,
                           cairo_surface_flush, cairo_set_line_width,
                           cairo_set_source_rgb, cairo_stroke, cairo_scale,
                           cairo_destroy, cairo_surface_destroy;
import crack.math PI, sqrt;

// Create the surface and context
cairo_surface_t surface;
cairo_t cr;
uint32 status;

surface = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, 120, 120);
cr = cairo_create (surface);
cairo_scale (cr, 120, 120);

cairo_set_line_width (cr, 0.1);
cairo_set_source_rgb (cr, 0, 0, 0);

// Draw some lines and curves
cairo_move_to (cr, 0.25, 0.25);
cairo_line_to (cr, 0.5, 0.375);
cairo_rel_line_to (cr, 0.25, -0.125);
cairo_arc (cr, 0.5, 0.5, 0.25 * sqrt(2), -0.25 * PI, 0.25 * PI);
cairo_rel_curve_to (cr, -0.25, -0.125, -0.25, 0.125, -0.5, 0);
cairo_close_path (cr);
cairo_stroke (cr);


cairo_surface_flush (surface);

// Write surface to PNG file
status = cairo_surface_write_to_png (surface, CString("path-close.png").buffer);

// Clean up
cairo_destroy (cr);
cairo_surface_destroy (surface);
